# ETA_Cacher

## Архитектура приложения

* back-end : Ruby on Rails
* front-end : ReactJS
* DB : MongoDB
* cache : Redis

## Описание алгоритма кэширования

* Пользователь запрашивает ETA:
Находим три ближайшие свободные машины и вычилсяем для каждой из них ETA по следующему принципу -
Положение пользователя округляется до порядка 0.001 и проверяется есть ли ключ вида `lat_lng_c1` (c1 - id машины) в кеше. Если есть - берем значение из кэша, если нет, то получаем eta через сторонний сервис и в кэш заносим ключи следующего вида:
`lat_lng_c1: ETA_c1`, `c1: [..., lat_lng_c1]`. То есть с каждой машиной ассоциируется массив анвалидаторов - ключей, которые удаляются из кеша при анвалидации кеша.

* Машина изменяет свое положение или состояние (свободна, занята):
Соответсвенно кеш устаревает и из него удаляются следующие ключи. Пробегаем по массиву по ключу c1 и удаляем все ключи-анвалидаторы и удаляем сам ключ c1.

* Таким образом кэш находится всегда в актуальном состоянии. Все запросы логируются в `log/cache.log`.